<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redevelopment Bazaar Score (RBS)</title>
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        .information{
            text-align: right;
        }

        .container {
            width: 600px;
            background: white;
         
            margin: auto;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            color: black;
            padding-left: 50px;
        }

        .date {
            text-align: right;
            font-weight: bold;
        }

        .info p, .score-section p, .improve ol, .score-factors ul {
            font-size: 14px;
            padding: 2px 0;
            padding-left: 50px;
            
        }

       

        #score-meter, .box {
    display: inline-block;
    vertical-align: middle;
}


        button {
            background: #003366;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            display: block;
            margin: 20px auto 0;
        }

        button:hover {
            background: #0055a5;
        }
        .fab-container {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.fab-icon {
    width: 50px;
    height: 50px;
    background-color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    transition: all 0.3s ease-in-out;
}

.fab-icon:hover {
    background-color: #f0f0f0;
    transform: scale(1.1);
}

.fab-icon img {
    width: 24px;
    height: 24px;
}
.score-section img {
    display: block; /* Inline element ko block banane ke liye */
    margin: 0;      /* Center se hata ke left pe laane ke liye */
    text-align: left; /* Agar kahi inheritance aa rahi hai toh */
    /* ✅ Row me align karega */
}
li{
    padding: 5px 0;
}
.box {
    border: 2px solid #333; /* ✅ Inner Border */
    padding: 10px 15px;
    display: flex;
  
   text-align: right;
    align-items: flex-end;
    border-radius: 8px;
    background-color: white;
    width: fit-content; 
}

    </style>
</head>
<body>

    <div id="pdf-content" class="container">
        <!-- Header -->
        <header>
            <img src="Header.png" alt="Header" style="width: 100%; height: 100%;">
           
          
            <div class="information">
            
            <p class="date" id="current-date"></p>
        </div>
        </header>
        <section class="info">
            <h2>Current Application Information</h2>
            <p><strong>These are the details you give us when you apply for your RBS</strong></p>
            <p><strong>Society Name:</strong> <span id="society-name"></span></p>
            <p><strong>Address:</strong> <span id="address"></span></p>
            <p><strong>Email:</strong> <span id="email"></span></p>
            <p><strong>Remark:</strong> <span id="remark"></span></p>
        </section>

        <!-- Score Section -->
        <section class="score-section">
            <h2>Redevelopment Bazaar Score [RBS]</h2>
            <p>This is summarized as a Redevelopment Credit <br> Score ranging from 300 - 850.</p>
            <img id="score-meter" src="Score-Meter.png" alt="score meter" width="225" style="display: block;padding-left: 30px; ">

            <span class="box">
                <h1>RBS SCORE</h1>
                <h2 id="score-value">600/850</h2> 
            </span>
        </section>

        <!-- Score Factors -->
        <section class="score-factors">
            <h3>Score Factors</h3>
            <ul>
                <li>Property Potential</li>
                <li>Developer Credibility</li>
                <li>Project Feasibility</li>
                <li>Financial Health</li>
                <li>Regulatory Compliance</li>
            </ul>
        </section>
        <section>
            <img src="Middle.png" alt="" width="100%">
        </section>
        <!-- Improvement Tips -->
        <section class="improve">
            <h3>How to Improve RBS?</h3>
            <ol>
                <li>Enhance Property Condition: Invest in property maintenance and upgrades.</li>
                <li>Partner with Reputable Developers: Collaborate with experienced and credible developers.</li>
                <li>Conduct Thorough Project Analysis: Assess project feasibility, regulatory compliance, and financial health.</li>
                <li>Maintain Regulatory Compliance: Ensure adherence to local regulations and permits.</li>
            </ol>
        </section>
        <section class="improve">
            <h3>BENEFITS OF RBS</h3>
            <ol>
                <li>Informed Decision-Making: Enables property owners, developers, and investors
                    to make informed decisions.</li>
                <li>Risk Assessment: Identifies potential risks and opportunities.</li>
                <li>Comparative Analysis: Facilitates comparison of different properties and
                    projects.</li>
                <li>Improved Collaboration: Enhances collaboration among stakeholders.</li>
            </ol>
        </section>
        <section class="improve">
            <h3>BENEFITS OF RBS TO OTHERS</h3>
            <ol>
                <li>Lenders: Assess creditworthiness and project viability.</li>
                <li>Investors: Evaluate investment potential and risk.</li>
                <li> Government Agencies: Monitor regulatory compliance and project feasibility.</li>
                <li>Consultants: Provide expert advice on redevelopment strategies.
                </li>
            </ol>
        </section>
        

        <!-- Contact -->
      <img src="Footer.png" alt="Footer" style="width: 100%; height: 100%;">
    
    </div>
<!-- Floating Action Buttons -->
<div class="fab-container">
    <div class="fab-icon" onclick="downloadPDF()">
        <img src="download-icon.png" alt="Download">
    </div>
    <div class="fab-icon" onclick="openDocument()">
        <img src="credential.png" alt="Document">
    </div>
    <div class="fab-icon" onclick="printPage()">
        <img src="printer-icon.png" alt="Print">
    </div>
    <div class="fab-icon" onclick="shareReport()">
        <img src="share.png" alt="Share">
    </div>
</div>

<h2>Generated PDF</h2>
    <button onclick="generateAndUploadPDF()">Download & Upload PDF</button>
    <a id="pdfLink" href="#" style="display:none;" download="result.pdf">Download PDF</a>
    <script>
        function printPage() {
    window.print(); // ✅ Page ko print karega
}
// ✅ Score Value Update
function updateScoreDisplay() {
    const score = parseInt(localStorage.getItem("finalScore")) || 600;
    document.getElementById("score-value").innerText = `${score}/850`;
}

document.addEventListener("DOMContentLoaded", updateScoreDisplay);

function shareReport() {
    if (navigator.share) {
        navigator.share({
            title: "Redevelopment Bazaar Score (RBS)",
            text: "Check out this RBS report!",
            url: window.location.href,
        }).catch((error) => console.log("Error sharing:", error));
    } else {
        alert("Sharing not supported on this browser.");
    }
}

function openDocument() {
    alert("Opening document functionality is not implemented yet.");
}

        document.getElementById("current-date").innerText = new Date().toLocaleDateString();
        
        const societyName = localStorage.getItem("societyName") || "Not Provided";
        const email = localStorage.getItem("email") || "Not Provided";
        const address = localStorage.getItem("address") || "Not Provided";
        const remark = localStorage.getItem("remark") || "No remarks available";
        const score = parseInt(localStorage.getItem("finalScore")) || 600;
        
        document.getElementById("society-name").innerText = societyName;
        document.getElementById("email").innerText = email;
        document.getElementById("address").innerText = address;
         document.getElementById("remark").innerText = `Your adjusted score is ${score}`
        
        // ✅ Score Meter Image Update Function
function updateScoreMeter() {
    const score = parseInt(localStorage.getItem("finalScore")) || 600; // Default 600
    let meterImage = "Good.jpg"; // Default Image

    if (score >= 300 && score <= 579) {
        meterImage = "Poor.jpg";
    } else if (score >= 580 && score <= 669) {
        meterImage = "fair.jpg";
    } else if (score >= 670 && score <= 739) {
        meterImage = "Good.jpg";
    } else if (score >= 740 && score <= 799) {
        meterImage = "very Good.jpg";
    } else if (score >= 800) {
        meterImage = "excellent.jpg";
    }

    // ✅ Set Image Dynamically
    let scoreMeterImg = document.getElementById("score-meter");
    if (scoreMeterImg) {
        scoreMeterImg.src = meterImage;
    } else {
        console.warn("⚠️ score-meter element not found!");
    }
}

// ✅ Call Function on Page Load
document.addEventListener("DOMContentLoaded", updateScoreMeter);

        
        function downloadPDF() {
    const { jsPDF } = window.jspdf; // ✅ Fix: jsPDF ko correctly import karo
    const element = document.getElementById("pdf-content");

    html2canvas(element, { scale: 2 }).then((canvas) => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF("p", "mm", "a4");

        const imgWidth = 210;
        const pageHeight = 297;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
            position -= pageHeight;
            pdf.addPage();
            pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        pdf.save(`RBS_Report_${societyName}.pdf`);
    });
}
async function generateAndUploadPDF() {
    const { jsPDF } = window.jspdf;
    let pdf = new jsPDF("p", "mm", "a4"); // A4 Size PDF
    
    // **1️⃣ High-Quality Screenshot (html2canvas)**
    let canvas = await html2canvas(document.body, {
        scale: 2,        // Higher resolution
        useCORS: true    // External images support
    });
    
    let imgData = canvas.toDataURL("image/png");

    let imgWidth = 210; // A4 width in mm
    let pageHeight = 297; // A4 height in mm
    let imgHeight = (canvas.height * imgWidth) / canvas.width;

    if (imgHeight > pageHeight) {
        pdf.addImage(imgData, "PNG", 10, 10, imgWidth - 20, pageHeight - 20);
    } else {
        pdf.addImage(imgData, "PNG", 10, 10, imgWidth - 20, imgHeight);
    }

    let pdfBlob = pdf.output("blob");

    // **2️⃣ Download PDF Button Show Karna**
    let pdfURL = URL.createObjectURL(pdfBlob);
    let pdfLink = document.getElementById("pdfLink");
    if (pdfLink) {
        pdfLink.href = pdfURL;
        pdfLink.style.display = "block";
    } else {
        console.warn("pdfLink element not found!");
    }

    // **3️⃣ PDF Upload API Call**
    let formData = new FormData();
    let pdfFile = new File([pdfBlob], "result.pdf", { type: "application/pdf" });
    formData.append("file", pdfFile);
    formData.append("user_id", "1");

    try {
        let response = await fetch("https://demowebiste.xyz/redevelopment/api.php", {
            method: "POST",
            body: formData
        });

        let result = await response.json();

        if (result.status === "success") {
            alert("✅ PDF Uploaded Successfully!");
            window.location.href = result.file_url; // PDF Open Karne Ke Liye
        } else {
            alert("❌ Upload failed! Error: " + result.message);
        }
    } catch (error) {
        console.error("Upload Error:", error);
    }
}

// **Auto-Generate & Upload PDF on Load**
document.addEventListener("DOMContentLoaded", function () {
    setTimeout(generateAndUploadPDF, 1000);
});



    </script>
</body>
</html>
